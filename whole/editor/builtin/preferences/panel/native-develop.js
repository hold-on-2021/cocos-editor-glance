"use strict";const Electron=require("electron"),Fs=require("fire-fs"),Path=require("fire-path"),Utils=Editor.require("packages://preferences/panel/utils");exports.template=`\n    <div class="native-develop">\n        <h2> {{T('PREFERENCES.tab.native_develop')}}\n            <div class="layout horizontal center error" v-show="errorInfo!==''">\n                <i class="fa fa-exclamation-triangle icon"></i>\n                <div>{{errorInfo}}</div>\n            </div>\n        </h2>\n\n        <ui-prop name="">\n            <div class="layout horizontal left">\n                <span> {{T('PREFERENCES.doc_link_title')}} </span>\n                <span class="link"\n                      v-on:click="onFrameworkHelpClick">\n                      {{T('PREFERENCES.doc_link_name')}}\n                </span>\n            </div>\n        </ui-prop>\n\n        \x3c!--使用内置 JavaScript 引擎--\x3e\n\n        <ui-prop\n            name="{{T('PREFERENCES.native.use_default_js_engine')}}"\n            tooltip="{{T('PREFERENCES.native.use_default_js_engine')}}"\n        >\n            <ui-checkbox v-value=use_default_js_engine></ui-checkbox>\n        </ui-prop>\n\n        \x3c!--JavaScript 引擎路径--\x3e\n\n        <ui-prop\n            name="{{T('PREFERENCES.native.js_engine_path')}}"\n            tooltip="{{T('PREFERENCES.native.js_engine_path')}}"\n        >\n            <div class="layout horizontal content">\n                <ui-input class="flex-2"\n                    v-value=profile['js-engine-path']\n                    v-on:confirm=onCheckJSEngine\n                    v-disabled=use_default_js_engine>\n                </ui-input>\n                <ui-button class="small"\n                    v-on:confirm="onChooseJSEnginePath"\n                    v-disabled=use_default_js_engine\n                >\n                    ···\n                </ui-button>\n                <ui-button class="small"\n                    v-on:confirm="onShowJSEngineInFinder"\n                >\n                    {{T('SHARED.open')}}\n                </ui-button>\n            </div>\n        </ui-prop>\n\n        \x3c!--使用内置 Cocos2d-x 引擎--\x3e\n\n\n        \x3c!--WechatGame 程序路径--\x3e\n        \n        <ui-prop\n            name="{{T('PREFERENCES.native.wechatgame_app_path')}}"\n        >\n            <div class="layout horizontal content">\n                <ui-input class="flex-2"\n                    v-value=profile['wechatgame-app-path']\n                    placeholder="wechatgame app path"\n                ></ui-input>\n                <ui-button class="small"\n                    v-on:confirm="onChooseWechatGameAppPathClick"\n                >\n                    ···\n                </ui-button>\n                <ui-button class="small"\n                    v-on:confirm="onShowWechatGameAppPathInFinderClick"\n                >\n                    {{T('SHARED.open')}}\n                </ui-button>\n            </div>\n        </ui-prop>\n\n        \x3c!--WechatGame 程序路径--\x3e\n\n        <ui-prop\n            name="{{T('PREFERENCES.native.use_default_cpp_engine')}}"\n            tooltip="{{T('PREFERENCES.native.use_default_cpp_engine')}}"\n        >\n            <ui-checkbox v-value=use_default_cpp_engine></ui-checkbox>\n        </ui-prop>\n\n        \x3c!--Cocos2d-x 路径--\x3e\n\n        <ui-prop\n            name="{{T('PREFERENCES.native.cpp_engine_path')}}"\n            tooltip="{{T('PREFERENCES.native.cpp_engine_path')}}"\n        >\n            <div class="layout horizontal content">\n                <ui-input class="flex-2"\n                    v-value=profile['cpp-engine-path']\n                    v-on:confirm=onCheckCppEngine\n                    v-disabled=use_default_cpp_engine\n                ></ui-input>\n                <ui-button class="small"\n                    v-on:confirm="onChooseCppEnginePath"\n                    v-disabled=use_default_cpp_engine\n                >\n                    ···\n                </ui-button>\n                <ui-button class="small"\n                    v-on:confirm="onShowCocosRootInFinderClick"\n                >\n                    {{T('SHARED.open')}}\n                </ui-button>\n            </div>\n        </ui-prop>\n\n        \x3c!--NDK 路径--\x3e\n\n        <ui-prop\n            name="{{T('PREFERENCES.ndk_root')}}"\n            tooltip="{{T('PREFERENCES.ndk_root')}}"\n        >\n            <div class="layout horizontal content">\n                <ui-input class="flex-2"\n                    v-value=profile['ndk-root']\n                    placeholder=${Editor.T("PREFERENCES.ndk_placeholder")}\n                ></ui-input>\n                <ui-button class="small"\n                    v-on:confirm="onChooseNDKRootClick"\n                >\n                    ···\n                </ui-button>\n                <ui-button class="small"\n                    v-on:confirm="onShowNDKRootInFinderClick"\n                >\n                    {{T('SHARED.open')}}\n                </ui-button>\n            </div>\n        </ui-prop>\n\n        \x3c!--Android SDK 路径--\x3e\n\n        <ui-prop\n            name="{{T('PREFERENCES.android_sdk_root')}}"\n            tooltip="{{T('PREFERENCES.android_sdk_root')}}"\n        >\n            <div class="layout horizontal content">\n                <ui-input\n                    v-value=profile['android-sdk-root']\n                    placeholder="sdk-root"\n                ></ui-input>\n                <ui-button class="small"\n                    v-on:confirm="onChooseAndroidSDKRootClick"\n                >\n                    ···\n                </ui-button>\n                <ui-button class="small"\n                    v-on:confirm="onShowAndroidSDKRootInFinderClick"\n                >\n                    {{T('SHARED.open')}}\n                </ui-button>\n            </div>\n        </ui-prop>\n\n        \x3c!--ANT 路径--\x3e\n\n        <ui-prop\n            name="{{T('PREFERENCES.ant_root')}}"\n            tooltip="{{T('PREFERENCES.ant_root')}}"\n        >\n            <div class="layout horizontal content">\n                <ui-input class="flex-2"\n                    v-value=ant_root\n                    placeholder="ant-root/bin"\n                ></ui-input>\n                <ui-button class="small"\n                    v-on:confirm="onChooseAntRootClick"\n                >\n                    ···\n                </ui-button>\n                <ui-button class="small"\n                    v-on:confirm="onShowAntRootInFinderClick"\n                >\n                    {{T('SHARED.open')}}\n                </ui-button>\n            </div>\n        </ui-prop>\n    </div>\n`,exports.props={profile:null,error:{towWay:!0,type:Boolean,default:!1},globalerror:{towWay:!0,type:Boolean,default:!1}},exports.data=function(){var n=this.profile;return{errorInfo:"",use_default_js_engine:n["use-default-js-engine"],use_default_cpp_engine:n["use-default-cpp-engine"],ant_root:n["ant-root"]}},exports.created=function(){this._applyJSEnginePath(this.profile["js-engine-path"]),this._applyCppEngine(this.profile["cpp-engine-path"]),this._checkAntRoot()},exports.watch={errorInfo:{handler(n){this.globalerror=this.error=""!==n}},use_default_js_engine:{handler(n){this._checkEngineError(),this.profile["use-default-js-engine"]=n,Editor.globalProfile.data["use-default-js-engine"]=n}},use_default_cpp_engine:{handler(n){this._checkEngineError(),this.profile["use-default-cpp-engine"]=n,Editor.globalProfile.data["use-default-cpp-engine"]=n}},ant_root:{handler(n){this.profile&&(this.profile["ant-root"]=n,this._checkAntRoot())}}},exports.methods={T:Editor.T,_checkEngineError(){this.use_default_js_engine||this._verifyJSEngine(this.profile["js-engine-path"]),this.use_default_cpp_engine||this._verifyCppEngine(this.profile["cpp-engine-path"]),this.errorInfo=""},_showInFinder(n){let o=this.profile[n];if(!Fs.existsSync(o))return this.errorInfo="Path ["+o+"] not exists!",void 0;Electron.shell.showItemInFolder(o),Electron.shell.beep()},_verifyJSEngine(n,o){Editor.Ipc.sendToMain("preferences:verify-engine-path",n,"cocos-creator-js",(n,e)=>{if(!e)return this.errorInfo=this.T("PREFERENCES.error.js_engine_invalid"),void 0;o&&o(e)})},_applyJSEnginePath(n){this.use_default_js_engine||(this.profile["js-engine-path"]=n,this.errorInfo="",this._verifyJSEngine(n,o=>{Editor.globalProfile.data["js-engine-path"]=n}))},onCheckJSEngine(n){n.stopPropagation(),this._applyJSEnginePath(n.detail.value)},onChooseJSEnginePath(n){n.stopPropagation(),Utils.choosePath("js-engine-path",n=>{n&&this._applyJSEnginePath(n[0])})},onShowJSEngineInFinder(n){n.stopPropagation(),this.use_default_js_engine?(Electron.shell.showItemInFolder(Editor.url("unpack://engine")),Electron.shell.beep()):this._showInFinder("js-engine-path")},_verifyCppEngine(n,o){Editor.Ipc.sendToMain("preferences:verify-engine-path",n,"cocos2d-x-lite",(n,e)=>{if(!e)return this.errorInfo=this.T("PREFERENCES.error.cpp_engine_invalid"),void 0;o&&o(e)})},_applyCppEngine(n){this.use_default_cpp_engine||(this.profile["cpp-engine-path"]=n,this.errorInfo="",this._verifyCppEngine(n,o=>{Editor.globalProfile.data["cpp-engine-path"]=n}),Utils.requireSimulatorConfig())},onCheckCppEngine(n){n.stopPropagation(),this._applyCppEngine(n.detail.value)},onChooseCppEnginePath(n){n.stopPropagation(),Utils.choosePath("cpp-engine-path",n=>{n&&this._applyCppEngine(n[0])})},onShowCocosRootInFinderClick(n){n.stopPropagation(),this.use_default_cpp_engine?(Electron.shell.showItemInFolder(Editor.remote.builtinCocosRoot),Electron.shell.beep()):this._showInFinder("cpp-engine-path")},onChooseWechatGameAppPathClick(n){n.stopPropagation();var o=this.profile["wechatgame-app-path"]||Editor.projectInfo.path;Electron.remote.dialog.showOpenDialog({defaultPath:o,properties:"darwin"===process.platform?void 0:["openDirectory"]},n=>{n&&(this.profile["wechatgame-app-path"]=n[0])})},onShowWechatGameAppPathInFinderClick(n){n.stopPropagation(),this._showInFinder("wechatgame-app-path")},onChooseNDKRootClick(n){n.stopPropagation(),Utils.choosePath("ndk-root",n=>{n&&(this.profile["ndk-root"]=n[0])})},onShowNDKRootInFinderClick(n){n.stopPropagation(),this._showInFinder("ndk-root")},onChooseAntRootClick(n){n.stopPropagation(),Utils.choosePath("ant-root",n=>{n&&(this.ant_root=n[0])})},onShowAntRootInFinderClick(n){n.stopPropagation(),this._showInFinder("ant-root")},_checkAntRoot(){this.errorInfo="";var n=this.ant_root;if(!Fs.existsSync(n))return this.errorInfo=Editor.T("PREFERENCES.error.ant_root_path_not_exists",{path:n}),void 0;Fs.existsSync(Path.join(n,"ant"))||(this.errorInfo=Editor.T("PREFERENCES.error.ant_not_exists",{path:Path.join(n,"ant")}))},onChooseAndroidSDKRootClick(n){n.stopPropagation(),Utils.choosePath("android-sdk-root",n=>{n&&(this.profile["android-sdk-root"]=n[0])})},onShowAndroidSDKRootInFinderClick(n){n.stopPropagation(),this._showInFinder("android-sdk-root")},onFrameworkHelpClick(n){n.stopPropagation(),Electron.shell.openExternal("http://www.cocos.com/docs/creator/publish/setup-native-development.html"),Electron.shell.beep()}};