"use strict";const Path=require("fire-path"),Electron=require("electron"),Fs=require("fire-fs"),Utils=Editor.require("packages://preferences/panel/utils"),DefaultBrowseEditor="default";exports.template='\n    <div class="data-editor">\n        <h2> {{T(\'PREFERENCES.tab.preview_run\')}}\n            <div class="layout horizontal center error" v-show="errorInfo">\n                <i class="fa fa-exclamation-triangle icon"></i>\n                <div>{{errorInfo}}</div>\n            </div>\n        </h2>\n\n        \x3c!--自动刷新--\x3e\n\n        <ui-prop\n            name="{{T(\'PREFERENCES.auto_refresh\')}}"\n            tooltip="{{T(\'PREFERENCES.auto_refresh\')}}"\n        >\n            <ui-checkbox v-value=profile[\'auto-refresh\']></ui-checkbox>\n        </ui-prop>\n\n        \x3c!--预览使用浏览器--\x3e\n\n        <ui-prop\n            name="{{T(\'PREFERENCES.preview_browser\')}}"\n            tooltip="{{T(\'PREFERENCES.preview_browser\')}}"\n        >\n            <ui-select id="previewBrowser"\n                v-value=profile[\'preview-browser\']\n                v-on:change="onSelectBrowserEditor"\n            >\n                <option value="default">{{T(\'PREFERENCES.default\')}}</option>\n                <option v-for="item in profile[\'preview-browser-list\']" v-value=item.value>{{item.text}}</option>\n            </ui-select>\n            <ui-button class="small"\n                v-on:confirm="onBrowseEditorClick"\n            >\n                {{T(\'PREFERENCES.browse\')}}\n            </ui-button>\n            <ui-button class="small"\n                v-show="show_remove"\n                v-on:confirm="onRemoveBrowseEditorClick"\n            >\n                {{T(\'PREFERENCES.remove\')}}\n            </ui-button>\n        </ui-prop>\n\n        \x3c!--内置模拟器路径--\x3e\n\n        <ui-prop\n            name="{{T(\'PREFERENCES.simulator_root\')}}"\n            tooltip="{{T(\'PREFERENCES.simulator_root\')}}"\n        >\n            <ui-input class="flex-2"\n                      v-value=[[_simulatorRoot()]]\n                      v-disabled="true">\n            </ui-input>\n            <ui-button class="small"\n                       v-disabled=!hasSimulator\n                       v-on:confirm="onShowSimulatorRootInFinderClick">\n                {{T(\'SHARED.open\')}}\n            </ui-button>\n        </ui-prop>\n\n        \x3c!--模拟器横竖屏设置--\x3e\n\n        <ui-prop\n            name="{{T(\'PREFERENCES.simulator_device_orientation\')}}"\n            tooltip="{{T(\'PREFERENCES.simulator_device_orientation\')}}"\n        >\n            <ui-select v-value=isLandscape\n                v-on:confirm="onSimulatorDeviceOrientationChange"\n                v-disabled=!hasSimulator\n            >\n                <option v-for="item in orientationList" v-value=item.value>{{item.text}}</option>\n            </ui-select>\n        </ui-prop>\n\n        \x3c!--模拟器分辨率设置--\x3e\n\n        <ui-prop\n            name="{{T(\'PREFERENCES.simulator_resolution\')}}"\n            tooltip="{{T(\'PREFERENCES.simulator_resolution\')}}"\n        >\n            <ui-select v-value=simulator_resolution\n                v-disabled=!hasSimulator\n            >\n                <option v-for="item in resolutionList" v-value=item.value>{{item.title}}</option>\n            </ui-select>\n        </ui-prop>\n\n        \x3c!--自定义分辨率设置--\x3e\n\n        <ui-prop\n            name="{{T(\'PREFERENCES.customize_resolution\')}}"\n            tooltip="{{T(\'PREFERENCES.customize_resolution\')}}"\n        >\n            <div class="layout horizontal center">\n                <span>{{T(\'PREFERENCES.width\')}}:</span>\n                <ui-num-input class="customInput"\n                    v-value=customize_resolution.width\n                    v-on:change="onCustomResolutionWidthChanged"\n                    v-disabled=!hasSimulator\n                ></ui-num-input>\n                <span>{{T(\'PREFERENCES.height\')}}:</span>\n                <ui-num-input class="customInput"\n                    v-value=customize_resolution.height\n                    v-on:change="onCustomResolutionHeightChanged"\n                    v-disabled=!hasSimulator\n                ></ui-num-input>\n            </div>\n        </ui-prop>\n    </div>\n',exports.props={profile:null,error:{towWay:!0,type:Boolean,default:!1},globalerror:{towWay:!0,type:Boolean,default:!1},show_remove:!1},exports.created=function(){this._applySimulator(),this.show_remove="default"!==this.profile["preview-browser"]},exports.data=function(){let t=this.profile;return{errorInfo:null,resolutionList:[],simulator_config:null,isLandscape:t["simulator-orientation"],hasSimulator:!1,orientationList:[{value:!0,text:Editor.T("PREFERENCES.simulator_device_horizontal")},{value:!1,text:Editor.T("PREFERENCES.simulator_device_vertical")}],customize_resolution_idx:-1,customize_resolution:{width:960,height:640},simulator_resolution:t["simulator-resolution"]}},exports.watch={errorInfo:{handler(t){this.globalerror=this.error=""!==t}},simulator_config:{handler(t){if(!t)return this.errorInfo=Editor.T("PREFERENCES.error.simulator_not_found"),this.hasSimulator=!1,void 0;if(0===t.length)return this.errorInfo=Editor.T("PREFERENCES.error.simulator_not_found_config"),this.hasSimulator=!1,void 0;this.errorInfo="",this.hasSimulator=!0,this.getSimulatorResolutionList();let o=t.init_cfg;o&&(this.customize_resolution.width=o.width,this.customize_resolution.height=o.height)}},simulator_resolution:{handler(t){let o=this.simulator_config.init_cfg,i=this.simulator_config.simulator_screen_size;o&&i&&(t-=0,this.profile["simulator-resolution"]=t,o&&this.customize_resolution_idx!==t&&(o.width=i[t].width,o.height=i[t].height,this.customize_resolution.width=o.width,this.customize_resolution.height=o.height),Utils.updateSimulatorConfig(this.simulator_config))}}},exports.methods={T:Editor.T,_applySimulator(){Utils.requireSimulatorConfig();let t=Utils.getSimulatorConfig();t||(this.errorInfo=Editor.T("PREFERENCES.error.simulator_not_found"),this.hasSimulator=!1),this.simulator_config=t},getSimulatorResolutionList(){let t=this.simulator_config.simulator_screen_size;if(!t)return;let o=this.resolutionList;for(let i=0;i<t.length;++i){let e=t[i];o.push({value:i+"",width:e.width,height:e.height,title:e.title})}o.push({value:t.length+"",title:Editor.T("PREFERENCES.sim_res_custom"),custom:!0}),this.customize_resolution_idx=o.length-1,this.resolutionList=o},_simulatorRoot(){return this.simulator_config?Editor.url("unpack://simulator/"):""},onAutoRefreshChanged(t){t.stopPropagation(),Utils.setProfile("auto-refresh",t.target.value)},onShowSimulatorRootInFinderClick(t){t.stopPropagation();var o=this._simulatorRoot();if(!Fs.existsSync(o))return Editor.warn(`Simulator root ${o} not exists!`),void 0;Electron.shell.showItemInFolder(o),Electron.shell.beep()},onSimulatorDeviceOrientationChange(t){t.stopPropagation();let o=this.simulator_config.init_cfg;o&&(o.isLandscape="true"===t.target.value,Utils.updateSimulatorConfig(this.simulator_config),this.profile["simulator-orientation"]=o.isLandscape)},onPreviewBrowserChange(t){t.stopPropagation(),Utils.setProfile("preview-browser",t.target.value)},onBrowseEditorClick(t){t.stopPropagation(),Utils.chooseExe("preview-browser",t=>{if(t){var o=Path.basenameNoExt(t[0]),i=this.profile["preview-browser-list"];Utils.hasContains(i,t[0])||(i.push({value:t[0],text:o}),this.profile["preview-browser"]=t[0],this.profile["preview-browser-list"]=i,this.show_remove=!0)}})},onSelectBrowserEditor(t){this.show_remove="default"!==t.detail.value},onRemoveBrowseEditorClick(t){t.stopPropagation();let o=this.profile["preview-browser"],i=this.profile["preview-browser-list"],e=Utils.getListIndexOf(i,o);-1!==e&&i.splice(e,1),i.length>0?this.profile["preview-browser"]=i[0].value:(this.profile["preview-browser"]="default",this.show_remove=!1)},_applyCustomResolution(t,o){let i=this.simulator_config.init_cfg;i&&(i[t]=event.target.value-0,this.simulator_resolution=this.customize_resolution_idx,Utils.updateSimulatorConfig(this.simulator_config))},onCustomResolutionWidthChanged(t){t.stopPropagation(),this._applyCustomResolution("width",t.target.value-0)},onCustomResolutionHeightChanged(t){t.stopPropagation(),this._applyCustomResolution("height",t.target.value-0)}};