"use strict";const Electron=require("electron"),ipcMain=Electron.ipcMain,spawn=require("child_process").spawn,Path=require("path"),Fs=require("fire-fs"),Plist=require("plist");ipcMain.on("assets:open-text-file",function(e,t){if("default"===Editor.Profile.load("profile://global/settings.json").data["script-editor"]){if(Editor.isWin32){return 1===Editor.Dialog.messageBox({type:"warning",buttons:[Editor.T("MESSAGE.cancel"),Editor.T("MESSAGE.yes")],title:Editor.T("MESSAGE.warning"),message:Editor.T("MESSAGE.warning"),detail:Editor.T("PREFERENCES.vacancy_script_editor_tips")})&&(Editor.Ipc.sendToMain("preferences:update-tab",1),Editor.Ipc.sendToPanel("preferences","update-tab",1),Editor.Panel.open("preferences")),void 0}let e=Editor.assetdb.uuidToFspath(t);Electron.shell.openItem(e)}else{let e=Editor.assetdb.uuidToFspath(t);e&&Editor.Ipc.sendToMain("assets:open-text-file-by-path",e)}}),ipcMain.on("assets:open-text-file-by-path",function(e,t){let i=Editor.Profile.load("profile://global/settings.json").data["script-editor"];if("default"==i)return Editor.warn("Can not open "+t+" because text editor is not configured.");let o=[],n="";if("darwin"===process.platform){if(i.endsWith(".app")){i=Path.join(i,"/Contents/MacOS/");let e=Plist.parse(Fs.readFileSync(Path.join(i,"../Info.plist"),"utf8"));i=Path.join(i,e.CFBundleExecutable)}-1!==i.indexOf("Visual Studio Code")?(n=i,o=[Editor.projectPath,t,"-n"]):(n="open",o=["-a",Path.basename(i),t])}else-1!==i.indexOf("Code")?(n=i,o=[Editor.projectPath,t,"-r"]):(n=i,o=[t]);spawn(n,o,{detached:!0,stdio:"ignore"}).unref()}),ipcMain.on("assets:open-texture-file",function(e,t){let i=Editor.assetdb.uuidToFspath(t);i&&Editor.Ipc.sendToMain("assets:open-texture-file-by-path",i)}),ipcMain.on("assets:open-texture-file-by-path",function(e,t){let i=Editor.Profile.load("profile://global/settings.json").data["picture-editor-root"];if(i){let e=[],o="";if("darwin"===process.platform){if(i.endsWith(".app")){i=Path.join(i,"/Contents/MacOS/");let e=Plist.parse(Fs.readFileSync(Path.join(i,"../Info.plist"),"utf8"));i=Path.join(i,e.CFBundleExecutable)}o="open",e=["-a",i,t]}else o=i,e=[t];spawn(o,e,{detached:!0,stdio:"ignore"}).unref()}});