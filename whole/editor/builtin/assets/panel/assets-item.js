(()=>{"use strict";Editor.polymerElement({hostAttributes:{draggable:"true"},properties:{foldable:{type:Boolean,value:!1,notify:!0,reflectToAttribute:!0},folded:{type:Boolean,value:!1,notify:!0,reflectToAttribute:!0},selected:{type:Boolean,value:!1,notify:!0,reflectToAttribute:!0},name:{type:String,value:""},extname:{type:String,value:""},assetType:{type:String,value:""},realUrl:{type:String,value:""},conflicted:{type:Boolean,value:!1,reflectToAttribute:!0},highlighted:{type:Boolean,value:!1,reflectToAttribute:!0},invalid:{type:Boolean,value:!1,reflectToAttribute:!0},readonly:{type:Boolean,value:!1,reflectToAttribute:!0}},listeners:{mousedown:"_onMouseDown",click:"_onClick",dblclick:"_onDblClick"},ready(){this._renaming=!1,this._userId=""},setIcon(e){let t;if("texture"===e){let e='url("'+(t=`thumbnail://${this._userId}?32`)+'")';return this.$.icon.style.backgroundImage===e&&(e='url("'+(t+="&_ts="+Date.now())+'")'),this.$.icon.style.backgroundImage=e,void 0}if("sprite-frame"===e){var i=this;return Editor.assetdb.queryMetaInfoByUuid(this._userId,(t,o)=>{if(!o)return i._useDefaultIcon(e),void 0;var r=JSON.parse(o.json);i._drawFrameIcon(r)}),void 0}this._useDefaultIcon(e)},_useDefaultIcon(e){let t,i=Editor.metas[e];if(i&&i["asset-icon"])return t=i["asset-icon"],this.$.icon.style.backgroundImage='url("'+t+'")',void 0;t="packages://assets/static/icon/"+e+".png",this.$.icon.style.backgroundImage='url("'+t+'")'},_drawFrameIcon(e){let t,i,o=`thumbnail://${e.rawTextureUuid}?32`,r=e.trimX,a=e.trimY,n=0;e.rotated?(t=e.height,i=e.width,n=270):(t=e.width,i=e.height);let l=`&x=${r}&y=${a}&w=${t}&h=${i}`;0!==n&&(l+=`&rotate=${n}`);let s='url("'+(o+=l)+'")';this.$.icon.style.backgroundImage===s&&(s='url("'+(o+="&_ts="+Date.now())+'")'),this.$.icon.style.backgroundImage=s},_nameClass:e=>e?"name":"no-name",_nameText:e=>e||"No Name",_foldIconClass:e=>e?"fa fa-caret-right":"fa fa-caret-down",_onMouseDown(e){if(1!==e.which)return;if(e.stopPropagation(),this._renaming)return;let t=!1,i=!1;e.shiftKey?t=!0:(e.metaKey||e.ctrlKey)&&(i=!0),this.fire("item-selecting",{toggle:i,shift:t})},_onClick(e){if(1!==e.which)return;e.stopPropagation();let t=!1,i=!1;e.shiftKey?t=!0:(e.metaKey||e.ctrlKey)&&(i=!0),this.fire("item-select",{toggle:i,shift:t})},_onDblClick(e){1===e.which&&(e.shiftKey||e.metaKey||e.ctrlKey||(clearTimeout(this._nameClickID),this._nameClickID=null,e.stopPropagation(),this.fire("open-asset",{uuid:this._userId})))},_onNameClick(e){if(this._nameClickID)return;let t=Editor.Selection.curGlobalActivate();if(!t||"asset"!==t.type||t.id!==this._userId)return;let i=Editor.Selection.curSelection("asset");Editor.Selection.confirmed("asset")&&1===i.length&&(e.stopPropagation(),clearTimeout(this._nameClickID),this._nameClickID=setTimeout(()=>{this._nameClickID=null,this.fire("item-rename")},300))},_onFoldMouseDown(e){e.stopPropagation()},_onFoldClick(e){e.stopPropagation(),1===e.which&&(this.folded=!this.folded)},_onFoldDblClick(e){e.stopPropagation()},_onIconMouseEnter(e){e.stopPropagation()},_onIconMouseLeave(e){e.stopPropagation()},insertItem(e){(function(e,t){let i=Polymer.dom(e),o=function(e,t,i){let o=t+i;"folder"===i&&(o="\t"+o);let r,a=0,n=e.length-1;for(;a<=n;){let t=e[r=a+n>>1],i=t.name+t.assetType;if("folder"===t.assetType&&(i="\t"+i),i<o)a=r+1;else{if(!(i>o))return r;n=r-1}}return a}(i.children,t.name,t.assetType);-1===o?i.appendChild(t):t!==i.children[o]&&i.insertBefore(t,i.children[o])})(this,e)},canAddChild(){return"folder"===this.assetType||"mount"===this.assetType},hint(e,t){e=e||"white",t=t||1e3;let i=window.getComputedStyle(this.$.bar);this.$.bar.animate([{background:e,transform:"scale(1.2)"},{background:i.backgroundColor,transform:"scale(1)"}],{duration:t})}})})();