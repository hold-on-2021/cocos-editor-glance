function _getFileInfo(e){for(let s=0;s<visitedFolders.length;++s){let t=visitedFolders[s];if(t.url===e)return t}return null}function _hasContainRes(e){return-1!==visitedFiles.indexOf(e)}function _analysisUrl(e,s,t,i,l){let n=i[++e];s=Path.join(s,n);if(Fs.statSync(s).isDirectory()){let r=_getFileInfo(s);r||((r=new FileRoot(n,s)).parent=t,t.children.push(r),visitedFolders.push(r),allAssets.push(r)),_analysisUrl(e,s,r,i,l)}else if(!_hasContainRes(l.uuid)){let e=new ResInfo(l);e.parent=t,t.children.push(e),visitedFiles.push(l.uuid),allAssets.push(e)}}function _addFileAndResInfo(e,s){let t=e.url.slice("db://assets/".length).split("/");if(1===t.length){let t=new ResInfo(e);t.parent=s,s.children.push(t),visitedFiles.push(e.uuid),allAssets.push(t)}else{_analysisUrl(-1,Path.join(Editor.projectInfo.path,"assets"),s,t,e)}}function _onInitData(){visitedFolders=[],visitedFiles=[],allAssets=[]}var Fs=require("fire-fs"),Path=require("fire-path"),Async=require("async"),Depend=require("./depend"),Utils=require("../utils");let visitedFolders=[],visitedFiles=[],allAssets=[],ResInfo=function(e){if(this.info=e,this.type=e.type||"",this.icon=Utils.getIcon(e.uuid),this.selected=!0,this.parent=null,"sprite-frame"===e.type){let s=Editor.assetdb.remote.loadMetaByUuid(e.uuid);this.url=Editor.assetdb.remote.uuidToFspath(s.rawTextureUuid),this.name=Path.basename(this.url)}else this.url=e.path,this.name=Path.basename(e.path)},FileRoot=function(e,s){this.name=e||"",this.url=s||"",this.children=[],this.type="directory",this.folded=!0,this.selected=!0,this.parent=null};module.exports={queryAssetTreeByUuidList:function(e,s){_onInitData();let t=new FileRoot("Assets");Async.each(e,(e,s)=>{Editor.assetdb.queryInfoByUuid(e,(e,i)=>e?s():-1!==i.url.indexOf(Depend.INTERNAL)?s():(_addFileAndResInfo(i,t),s(),void 0))},()=>{Depend.sortAssetTree(t,()=>{s(null,{assetTree:t,allAssets:allAssets})})})}};