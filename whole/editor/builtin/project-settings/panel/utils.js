"use strict";const Fs=require("fire-fs"),win32Config="unpack://simulator/win32/config.json",macConfig="unpack://simulator/mac/Simulator.app/Contents/Resources/config.json",configPath=Editor.isWin32?win32Config:macConfig,simulatorConfig=Editor.require(configPath);exports.profiles={project:null,global:null},exports.init=function(){return Promise.resolve().then(()=>new Promise((t,e)=>{Editor.Profile.load("profile://project/project.json",(i,o)=>{if(i)return e(i);exports.profiles.project=o,t()})})).then(()=>new Promise((t,e)=>{Editor.Profile.load("profile://global/settings.json",(i,o)=>{if(i)return e(i);exports.profiles.global=o,t()})}))};let queryGroupList=function(){let t=[];return exports.profiles.project.data["group-list"]?(exports.profiles.project.data["group-list"].forEach(e=>{t.push(e)}),t):t},queryCollision=function(){let t=exports.profiles.project.data["collision-matrix"]||[];return JSON.parse(JSON.stringify(t))},queryExcluded=function(){let t=exports.profiles.project.data["excluded-modules"]||[];return JSON.parse(JSON.stringify(t))},queryPreview=function(){return{scene:exports.profiles.project.data["start-scene"]||"current",resolutionWidth:exports.profiles.project.data["design-resolution-width"],resolutionHeight:exports.profiles.project.data["design-resolution-height"],fitWidth:exports.profiles.project.data["fit-width"],fitHeight:exports.profiles.project.data["fit-height"]}},querySimulator=function(){if(!simulatorConfig)return null;let t=exports.profiles.project.data,e=t["use-project-simulator-setting"],i=t["simulator-orientation"]||simulatorConfig.isLandscape,o=t["simulator-resolution"]||{},r=t["use-customize-simulator"],s=simulatorConfig.simulator_screen_size.map((t,e)=>({index:e,width:t.width,height:t.height,title:t.title}));s.push({index:s.length,title:Editor.T("PREFERENCES.sim_res_custom"),custom:!0,width:o.width,height:o.height});let l;if(r)l=s.length-1;else{s.some((t,e)=>{if(t.width===o.width&&t.height===o.height)return l=e,!0})||(r=!0,l=s.length-1)}return{type:e?"project":"global",direction:i?"horizontal":"vertical",resolution:l,resolutionList:s,width:o.width,height:o.height}},queryAnalytics=function(){let t=exports.profiles.project.data,e=t["cocos-analytics"];return e||(e=t["cocos-analytics"]={}),{enable:e.enable,appID:e.appID,appSecret:e.appSecret,channel:e.channel,version:e.version}};exports.queryGroupList=queryGroupList,exports.queryCollision=queryCollision,exports.queryExcluded=queryExcluded,exports.queryPreview=queryPreview,exports.querySimulator=querySimulator,exports.queryAnalytics=queryAnalytics;let setGroupList=function(t){let e=exports.profiles.project.data,i=e["group-list"];for(i||(i=e["group-list"]=[]);i.length>t.length;)i.pop();t.forEach((t,e)=>{i[e]=t})},setCollision=function(t){exports.profiles.project.data["collision-matrix"]=JSON.parse(JSON.stringify(t))},setExcluded=function(t){exports.profiles.project.data["excluded-modules"]=JSON.parse(JSON.stringify(t))},setPreview=function(t){let e=exports.profiles.project.data;"current"!==t.scene?e["start-scene"]=t.scene:delete e["start-scene"],e["design-resolution-width"]=t.resolutionWidth,e["design-resolution-height"]=t.resolutionHeight,e["fit-width"]=t.fitWidth,e["fit-height"]=t.fitHeight},setSimulator=function(t){let e=exports.profiles.project.data;e["use-project-simulator-setting"]=!("project"!=t.type),e["simulator-orientation"]=!("horizontal"!=t.direction),e["use-customize-simulator"]=!!(t.resolution>=t.resolutionList.length-1),e["simulator-resolution"]={width:t.width,height:t.height};let i=simulatorConfig.init_cfg;if("global"===t.type){let e=exports.profiles.global.data,o=e["simulator-resolution"],r=t.resolutionList[o];i.width=r.width,i.height=r.height,i.isLandscape="true"===e["simulator-orientation"]}else i.width=t.width,i.height=t.height,i.isLandscape=!("horizontal"!=t.direction)},setAnalytics=function(t){let e=exports.profiles.project.data["cocos-analytics"];e.enable=t.enable,e.appID=t.appID||"",e.appSecret=t.appSecret||"",e.channel=t.channel||"",e.version=t.version||""};exports.setGroupList=setGroupList,exports.setCollision=setCollision,exports.setExcluded=setExcluded,exports.setPreview=setPreview,exports.setSimulator=setSimulator,exports.setAnalytics=setAnalytics,exports.save=function(){exports.profiles.project.save(),Fs.writeJsonSync(Editor.url(configPath),simulatorConfig,"utf-8"),Editor.Ipc.sendToAll("editor:project-profile-updated",exports.profiles.project.data)};