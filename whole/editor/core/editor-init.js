"use strict";function _checkMountValid(t){if(!Fs.isDirSync(t))return!1;var r=Path.basename(t),e=Path.dirname(t),o=Path.join(e,"project.json");return!("assets"!==r||!Fs.existsSync(o))||e!==t&&_checkMountValid(e)}function _getUniqueName(t,r){for(var e=1;r.indexOf(t)>=0;)0===t.indexOf("mount-")?(t+=`-${e}`,e+=1):t="mount-"+t;return t}function _getMountInfos(t){if(!t||!Array.isArray(t))return null;for(var r=[],e=["assets","internal"],o=0,i=t.length;o<i;o++){let i=t[o];if(i=Path.isAbsolute(i)?Path.normalize(i):Path.normalize(Path.join(Editor.projectPath,i)),!_checkMountValid(i)){Editor.warn(`${i} is not a valid mount path.`);continue}let n=_getUniqueName(Path.basename(i),e);e.push(n),r.push({path:i,name:n})}return r}const Chalk=require("chalk"),Path=require("fire-path"),Os=require("os"),Fs=require("fire-fs");let options=Editor.argv;process.on("uncaughtException",t=>{if(Editor&&Editor.error)return Editor.error(t.stack||t),Editor.Metrics.trackException(t.stack||t),void 0;console.log(Chalk.red.inverse.bold("Uncaught Exception: ")+Chalk.red(t.stack||t))}),require("../../share/protocol/protocol-core"),Editor.User=require("../../share/login"),require("../share/editor-utils"),Editor.Project=require("../../share/project"),Editor.Metrics=require("../../share/metrics/metrics-core"),Editor.Scene=require("../share/editor-scene"),Editor.Compiler=require("./compiler"),Editor.QuickCompiler=require("./quick-compiler"),Editor.Builder=require("./builder"),Editor.PreviewServer=require("./preview-server"),Editor.NativeUtils=require("./native-utils"),Editor.projectPath="",Editor.projectInfo=null,Editor.metaBackupPath="temp/RemovedMetas",Editor.assetBackupPath="temp/BackupAssets",Editor.isOffline=!1,Editor.stashedScene=null,Editor.currentSceneUuid=null,Editor._runDashboard=!1,Editor._buildCommand=options.build,Editor._compileCommand=options.compile,Editor._commandLinePublish="string"==typeof Editor._buildCommand||"string"==typeof Editor._compileCommand,Editor.argv._command?Editor.projectPath=Path.join(Os.tmpdir(),"fireball-tmp-project"):options._.length>0?Editor.projectPath=Path.resolve(options._[0]):options.path&&(Editor.projectPath=Path.resolve(options.path)),Editor.requireLogin=!options.nologin,Editor.showInternalMount=Editor.dev&&!!options.internal,Editor.externalMounts=_getMountInfos(options.mount),Editor.mountsWritable=options.writable;let profileData=Editor.App._profile.data;Editor.lastLogin=profileData["last-login"],Editor.assets||(Editor.assets={}),Editor.metas||(Editor.metas={}),Editor.inspectors||(Editor.inspectors={}),Editor.properties||(Editor.properties={}),Editor.assettype2name||(Editor.assettype2name={}),Editor.gizmos={},Editor.sceneScripts={},Editor.updateIpAddress=function(){var t=Os.networkInterfaces(),r=[];for(var e in t)t[e].forEach(t=>{"IPv4"===t.family&&!1===t.internal&&r.push(t.address)});"win32"===process.platform&&(r=r.filter(t=>/^(?!169\.254)/.test(t))),Editor.IP=r[0]||"127.0.0.1",Editor.IPList=r};