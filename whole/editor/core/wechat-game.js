const compareVersions=require("compare-versions"),Dialog=require("electron").dialog;module.exports={run(r){const e=require("fire-path"),o=require("fire-fs");let t=Editor.App._profile.data["wechatgame-app-path"];if(!t)return Editor.error(Editor.T("PREFERENCES.error.wechatgame_app_path_empty")),void 0;let i,a;if("darwin"===process.platform?(i=e.join(t,"Contents/Resources/app.nw/bin/cli"),a=e.join(t,"Contents/Resources/app.nw/package.json")):(i=e.join(t,"cli.bat"),a=e.join(t,"package.nw/package.json")),!o.existsSync(i))return Dialog.showErrorBox(Editor.T("BUILDER.error.build_error"),Editor.T("BUILDER.wechat_game.client_path_error",{path:i})),void 0;let n="";if(o.existsSync(a)){n=JSON.parse(o.readFileSync(a,"utf8")).version}else Editor.warn(Editor.T("BUILDER.wechat_game.client_info_path_err",{path:a}));let s=["-o",r.dest];n&&compareVersions(n,"1.02.1801081")>0?s=s.concat(["-f","cocos"]):Editor.warn(Editor.T("BUILDER.wechat_game.client_version_low")),console.log(`Run command : ${s.join(" ")}`);let c=(0,require("child_process").spawn)(i,s);c.stdout.on("data",function(r){Editor.log(r.toString())}),c.stderr.on("data",function(r){Editor.error(r.toString())})}};