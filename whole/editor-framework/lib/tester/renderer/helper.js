"use strict";function _motionPath(e){let t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d",e.path);let n=t.getTotalLength(),o=0,s=null,i=function(u){if(void 0!==e.steps){let s=(o+=1)/e.steps;s=Math.min(s,1);let u=t.getPointAtLength(s*n);o<e.steps?(e.onUpdate({x:u.x,y:u.y,progress:s}),setTimeout(i,100)):e.onComplete({x:u.x,y:u.y,progress:s})}else{s||(s=u);let o=(u-s)/e.duration;o=Math.min(o,1);let r=t.getPointAtLength(o*n);o<1?(e.onUpdate({x:r.x,y:r.y,progress:o}),window.requestAnimationFrame(i)):e.onComplete({x:r.x,y:r.y,progress:o})}},u=t.getPointAtLength(0);e.onStart({x:u.x,y:u.y,progress:0}),void 0!==e.steps?setTimeout(i,100):window.requestAnimationFrame(i)}function _keyboardEventFor(e,t,n){let o=new window.CustomEvent(e);return o.keyCode=t,o.code=Editor.KeyCode.names[t],o.which=t,n&&(-1!==n.indexOf("shift")?o.shiftKey=!0:-1!==n.indexOf("ctrl")?o.ctrlKey=!0:-1!==n.indexOf("command")?o.metaKey=!0:-1!==n.indexOf("alt")&&(o.altKey=!0)),o}function _showMouseHintAt(e,t,n){null===_mouseHint&&((_mouseHint=document.createElement("div")).classList.add("mouse-hint"),_mouseHint.style.position="absolute",_mouseHint.style.width="10px",_mouseHint.style.height="10px"),_mouseHint.classList.add(n),_mouseHint.style.left=`${e-5}px`,_mouseHint.style.top=`${t-5}px`,document.body.appendChild(_mouseHint)}function _hideMouseHint(){null!==_mouseHint&&(_mouseHint.className="mouse-hint",_mouseHint.remove())}const Electron=require("electron");let webContents=Electron.remote.getCurrentWebContents(),Helper=require("../share/helper");Object.assign(Helper,{detail:!1,showMouseHint:!0,focus(e){Editor.UI.focus(e)},blur(){Editor.UI.focus(null)},type(e,t){t=t||[],webContents.sendInputEvent({type:"keyDown",keyCode:e,modifiers:t}),webContents.sendInputEvent({type:"char",keyCode:e,modifiers:t}),webContents.sendInputEvent({type:"keyUp",keyCode:e,modifiers:t})},keydown(e,t){t=t||[],webContents.sendInputEvent({type:"keyDown",keyCode:e,modifiers:t})},keyup(e,t){t=t||[],webContents.sendInputEvent({type:"keyUp",keyCode:e,modifiers:t})},keypress(e,t){e.dispatchEvent(_keyboardEventFor("keypress",Editor.KeyCode(t)))},click(e,t,n,o,s){t=t||"left",n=n||[],this.mousedown(e,t,n,1,o,s),this.mouseup(e,t,n,1,o,s)},dblclick(e,t,n,o,s){t=t||"left",n=n||[],this.mousedown(e,t,n,2,o,s),this.mouseup(e,t,n,2,o,s)},mousedown(e,t,n,o,s,i){let u=this.offset(e,s,i);t=t||"left",n=n||[],o=o||1,webContents.sendInputEvent({type:"mouseDown",x:parseInt(u.x),y:parseInt(u.y),button:t,modifiers:n,clickCount:o}),this.showMouseHint&&_showMouseHintAt(u.x,u.y,"down")},mouseup(e,t,n,o,s,i){let u=this.offset(e,s,i);t=t||"left",n=n||[],o=o||1,webContents.sendInputEvent({type:"mouseUp",x:parseInt(u.x),y:parseInt(u.y),button:t,modifiers:n,clickCount:o}),this.showMouseHint&&_hideMouseHint()},mousewheel(e,t,n,o,s,i){let u=this.offset(e,s,i);t=t||[],void 0!==o&&null!==o||(o=n),e.dispatchEvent(new window.WheelEvent("mousewheel",{bubbles:!0,cancelable:!0,clientX:u.x,clientY:u.y,deltaX:n,deltaY:o}))},mousemove(e,t,n,o,s){t=t||"left";let i,u,r,m;_motionPath({path:o,duration:n=n||500,onStart:e=>{r=e.x,m=e.y,webContents.sendInputEvent({type:"mousemove",x:parseInt(e.x),y:parseInt(e.y),button:t,movementX:parseInt(0),movementY:parseInt(0)}),this.showMouseHint&&_showMouseHintAt(e.x,e.y,"moving")},onUpdate:e=>{i=e.x-r,r=e.x,u=e.y-m,m=e.y,webContents.sendInputEvent({type:"mousemove",x:parseInt(e.x),y:parseInt(e.y),button:t,movementX:parseInt(i),movementY:parseInt(u)}),this.showMouseHint&&_showMouseHintAt(e.x,e.y,"moving")},onComplete:e=>{i=e.x-r,r=e.x,u=e.y-m,m=e.y,webContents.sendInputEvent({type:"mousemove",x:parseInt(e.x),y:parseInt(e.y),button:t,movementX:parseInt(i),movementY:parseInt(u)}),this.showMouseHint&&_hideMouseHint(),s&&setTimeout(s,1)}})},mousemoveStep(e,t,n,o,s){t=t||"left";let i,u,r,m;_motionPath({path:o,steps:n=n||5,onStart:e=>{r=e.x,m=e.y,webContents.sendInputEvent({type:"mousemove",x:parseInt(e.x),y:parseInt(e.y),button:t,movementX:parseInt(0),movementY:parseInt(0)}),this.showMouseHint&&_showMouseHintAt(e.x,e.y,"moving")},onUpdate:e=>{i=e.x-r,r=e.x,u=e.y-m,m=e.y,webContents.sendInputEvent({type:"mousemove",x:parseInt(e.x),y:parseInt(e.y),button:t,movementX:parseInt(i),movementY:parseInt(u)}),this.showMouseHint&&_showMouseHintAt(e.x,e.y,"moving")},onComplete:e=>{i=e.x-r,r=e.x,u=e.y-m,m=e.y,webContents.sendInputEvent({type:"mousemove",x:parseInt(e.x),y:parseInt(e.y),button:t,movementX:parseInt(i),movementY:parseInt(u)}),this.showMouseHint&&_hideMouseHint(),s&&setTimeout(s,1)}})},mousetrack(e,t,n,o,s){this.mousedown(e,t),this.mousemove(e,t,n,o,()=>{this.mouseup(e,t),s&&s()})},mousetrackStep(e,t,n,o,s){this.mousedown(e,t),this.mousemoveStep(e,t,n,o,()=>{this.mouseup(e,t),s&&s()})},pressAndReleaseKeyOn(e){this.keydown(e),setTimeout(()=>{this.keyup(e)},1)},pressEnter(){this.pressAndReleaseKeyOn("enter")},pressSpace(){this.pressAndReleaseKeyOn("space")},fireEvent(e,t,n){let o=new window.CustomEvent(t,{bubbles:!0,cancelable:!0});for(let e in n)o[e]=n[e];e.dispatchEvent(o)},offset(e,t,n){e||(e=document.body);let o=e.getBoundingClientRect();return"number"!=typeof t&&(t=o.width/2),"number"!=typeof n&&(n=o.height/2),{x:o.left+t,y:o.top+n}},center(e){e||(e=document.body);let t=e.getBoundingClientRect();return{x:t.left+t.width/2,y:t.top+t.height/2}},topleft(e){e||(e=document.body);let t=e.getBoundingClientRect();return{x:t.left,y:t.top}},importHTML(e,t){let n=document.createElement("link");n.rel="import",n.href=e,n.onload=function(){t(this.import)},document.head.appendChild(n)},loadTemplate(e,t,n){this.importHTML(e,e=>{if(t){let o=e.querySelector(`#${t}`);if(!o)throw new Error(`Cannot find template by id ${t}`);return n(o),void 0}n(e.querySelector("template"))})},createFrom(e,t,n){"function"==typeof t&&(n=t,t=""),this.loadTemplate(e,t,e=>{if(!e||"TEMPLATE"!==e.tagName)return n(),void 0;let t=document.importNode(e.content,!0);window.CustomElements&&window.CustomElements.upgradeSubtree&&window.CustomElements.upgradeSubtree(t),n(t)})},runElement(e,t,n,o){this.createFrom(e,t,e=>{let t;t=n?e.querySelector(n):e.firstElementChild,document.body.appendChild(e),this._targetEL=t,o(t)})},runPanel(e,t){Editor.Panel.newFrame(e,(e,n)=>{if(e)throw e;document.body.appendChild(n),n.load(e=>{if(e)throw e;n.ready&&n.ready(),n.run&&n.run(),this._spy(),this._targetEL=n,t(n)})})},reset(){_hideMouseHint(),this._unspy(),this._targetEL&&(this._targetEL.remove(),this._targetEL=null)}}),module.exports=Helper;let _mouseHint=null;